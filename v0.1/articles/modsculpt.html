<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="modsculpt">
<title>Introduction to Model Sculpting • modsculpt</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to Model Sculpting">
<meta property="og:description" content="modsculpt">
<meta property="og:image" content="https://genentech.github.io/modsculpt/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary" data-bs-theme="dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">modsculpt</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/modsculpt.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/binary.html">Binary Example</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-reports">Reports</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-reports">
    <a class="dropdown-item" href="../../unit-test-report/">Unit test report</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://www.github.com/genentech/modsculpt">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Introduction to Model Sculpting</h1>
            
      
      
      <div class="d-none name"><code>modsculpt.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The goal of this vignette is to make you familiar with model
sculpting. We do this by using a publicly available “bike sharing”
dataset.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://genentech.github.io/modsculpt">modsculpt</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="data-preparation">Data preparation<a class="anchor" aria-label="anchor" href="#data-preparation"></a>
</h2>
<p>Download the dataset at <a href="http://archive.ics.uci.edu/ml/datasets/Bike+Sharing+Dataset" class="external-link">http://archive.ics.uci.edu/ml/datasets/Bike+Sharing+Dataset</a>,
unzip, and load <code>day.csv</code>. You can use the following code to
do all the steps above:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html" class="external-link">download.file</a></span><span class="op">(</span></span>
<span>  <span class="st">"http://archive.ics.uci.edu/ml/machine-learning-databases/00275/Bike-Sharing-Dataset.zip"</span>,</span>
<span>  destfile <span class="op">=</span> <span class="st">"bike_rentals.zip"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/unzip.html" class="external-link">unzip</a></span><span class="op">(</span><span class="st">"bike_rentals.zip"</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"day.csv"</span><span class="op">)</span></span></code></pre></div>
<p>Firstly, check the dimensionality:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 731  16</span></span></code></pre></div>
<p>Have a look at the dataset</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span><span class="co">#&gt;   instant     dteday season yr mnth holiday weekday workingday weathersit</span></span>
<span><span class="co">#&gt; 1       1 2011-01-01      1  0    1       0       6          0          2</span></span>
<span><span class="co">#&gt; 2       2 2011-01-02      1  0    1       0       0          0          2</span></span>
<span><span class="co">#&gt; 3       3 2011-01-03      1  0    1       0       1          1          1</span></span>
<span><span class="co">#&gt; 4       4 2011-01-04      1  0    1       0       2          1          1</span></span>
<span><span class="co">#&gt; 5       5 2011-01-05      1  0    1       0       3          1          1</span></span>
<span><span class="co">#&gt; 6       6 2011-01-06      1  0    1       0       4          1          1</span></span>
<span><span class="co">#&gt;       temp    atemp      hum windspeed casual registered  cnt</span></span>
<span><span class="co">#&gt; 1 0.344167 0.363625 0.805833 0.1604460    331        654  985</span></span>
<span><span class="co">#&gt; 2 0.363478 0.353739 0.696087 0.2485390    131        670  801</span></span>
<span><span class="co">#&gt; 3 0.196364 0.189405 0.437273 0.2483090    120       1229 1349</span></span>
<span><span class="co">#&gt; 4 0.200000 0.212122 0.590435 0.1602960    108       1454 1562</span></span>
<span><span class="co">#&gt; 5 0.226957 0.229270 0.436957 0.1869000     82       1518 1600</span></span>
<span><span class="co">#&gt; 6 0.204348 0.233209 0.518261 0.0895652     88       1518 1606</span></span></code></pre></div>
<p>In this dataset, <code>instant</code> is the primary key,
<code>cnt</code> is the response that we want to predict, columns
<code>season:windspeed</code> are the features we can use for
prediction.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">response</span> <span class="op">&lt;-</span> <span class="st">"cnt"</span></span>
<span><span class="va">covariates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"season"</span>, <span class="st">"yr"</span>, <span class="st">"mnth"</span>, <span class="st">"holiday"</span>, <span class="st">"weekday"</span>, <span class="st">"workingday"</span>, <span class="st">"weathersit"</span>, <span class="st">"temp"</span>, <span class="st">"atemp"</span>, <span class="st">"hum"</span>, <span class="st">"windspeed"</span><span class="op">)</span></span></code></pre></div>
<p>Let’s get rid of <code>instant</code>, <code>dteday</code>,
<code>casual</code> and <code>registered</code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span><span class="op">$</span><span class="va">instant</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">dteday</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">casual</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">registered</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span></code></pre></div>
<p>Lastly, we need to properly encode discrete variables into
factors:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">idx_factor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span><span class="va">df</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">12</span>, <span class="fu"><a href="https://rdrr.io/r/base/logical.html" class="external-link">logical</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">[</span><span class="va">idx_factor</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="va">idx_factor</span><span class="op">]</span>, <span class="va">as.factor</span><span class="op">)</span></span></code></pre></div>
<p>We treat the following variables as factors:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">idx_factor</span><span class="op">)</span><span class="op">[</span><span class="va">idx_factor</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "season"     "yr"         "mnth"       "holiday"    "weekday"   </span></span>
<span><span class="co">#&gt; [6] "workingday" "weathersit"</span></span></code></pre></div>
<p>The goal of this document is to show how model sculpting can be used.
Therefore, we will not explore the bike rentals dataset further but
rather go ahead with the model sculpting.</p>
</div>
<div class="section level2">
<h2 id="model-sculpting">Model Sculpting<a class="anchor" aria-label="anchor" href="#model-sculpting"></a>
</h2>
<div class="section level3">
<h3 id="build-a-base-model">Build a base model<a class="anchor" aria-label="anchor" href="#build-a-base-model"></a>
</h3>
<p>Before we can move to model sculpting, we need an actual model that
we can sculpt. Let’s build an xgboost model. Yet before we start, it is
good to check the following:</p>
<ol style="list-style-type: decimal">
<li>Investigate the NAs. Check if there are any NAs with the following
code:</li>
</ol>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">anyNA</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<p><em>For model sculpting, you should remove or impute NAs if you have
any.</em></p>
<ol start="2" style="list-style-type: decimal">
<li>Remove constant (or zero-variance) columns. Check if there are any
with the following code:</li>
</ol>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># for continuous features</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="op">!</span><span class="va">idx_factor</span><span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">1e-10</span><span class="op">)</span></span>
<span><span class="co">#&gt; $temp</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $atemp</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $hum</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $windspeed</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $cnt</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># for discrete features</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="va">idx_factor</span><span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; $season</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $yr</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $mnth</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $holiday</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $weekday</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $workingday</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $weathersit</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<p><em>For model sculpting, you should remove zero-variance columns if
you have any.</em></p>
<div class="section level4">
<h4 id="build-a-strong-learner">Build a strong learner<a class="anchor" aria-label="anchor" href="#build-a-strong-learner"></a>
</h4>
<p>In this vignette, we will split the available data to train / holdout
sets with ratio 70 / 30.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">9876</span><span class="op">)</span></span>
<span><span class="va">idx_holdout</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>, size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="fl">0.3</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df_h</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">idx_holdout</span>, <span class="op">]</span></span>
<span><span class="va">df_t</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="op">-</span><span class="va">idx_holdout</span>, <span class="op">]</span></span></code></pre></div>
<p>Let’s quickly (i.e. the hyperparameters are already predefined) build
an xgboost model for our bike rentals dataset:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"xgboost"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required namespace: xgboost</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">567</span><span class="op">)</span></span>
<span><span class="va">est</span> <span class="op">&lt;-</span> <span class="fu">xgboost</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/xgboost/man/xgb.train.html" class="external-link">xgb.train</a></span><span class="op">(</span></span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    booster <span class="op">=</span> <span class="st">"gbtree"</span>,</span>
<span>    objective <span class="op">=</span> <span class="st">"reg:squarederror"</span>,</span>
<span>    eta <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>    gamma <span class="op">=</span> <span class="fl">3</span>,</span>
<span>    max_depth <span class="op">=</span> <span class="fl">3</span>,</span>
<span>    min_child_weight <span class="op">=</span> <span class="fl">5</span>,</span>
<span>    colsample_bytree <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    subsample <span class="op">=</span> <span class="fl">0.7</span></span>
<span>  <span class="op">)</span>,</span>
<span>  nrounds <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  data <span class="op">=</span> <span class="fu">xgboost</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/xgboost/man/xgb.DMatrix.html" class="external-link">xgb.DMatrix</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="op">~</span> <span class="va">.</span> <span class="op">-</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">df_t</span><span class="op">[</span><span class="va">covariates</span><span class="op">]</span><span class="op">)</span>,</span>
<span>    label <span class="op">=</span> <span class="va">df_t</span><span class="op">[[</span><span class="va">response</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="op">)</span>,</span>
<span>  verbose <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  nthread <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Here you can see the variable importances based on xgboost:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">xgboost</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/xgboost/man/xgb.plot.importance.html" class="external-link">xgb.plot.importance</a></span><span class="op">(</span><span class="fu">xgboost</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/xgboost/man/xgb.importance.html" class="external-link">xgb.importance</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">est</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="modsculpt_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
</div>
</div>
<div class="section level3">
<h3 id="build-a-rough-model">Build a rough model<a class="anchor" aria-label="anchor" href="#build-a-rough-model"></a>
</h3>
<p>Let’s sculpt this xgboost model.</p>
<p>Firstly, we need to define a prediction function that takes data as
input and returns predictions based on the trained model (in this case,
the xgboost above):</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xgb_pred</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">est</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="op">~</span> <span class="va">.</span> <span class="op">-</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Secondly, we need to generate product marginals, a grid of values
that is sampled independently per each column from the original dataset.
For more detailed information on why we do this, please check out the
function documentation.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sample_marginals.html">sample_marginals</a></span><span class="op">(</span></span>
<span>  dat <span class="op">=</span> <span class="va">df_t</span><span class="op">[</span><span class="va">covariates</span><span class="op">]</span>, <span class="co"># generate product marginals based on original training data</span></span>
<span>  n <span class="op">=</span> <span class="fl">10000</span>, <span class="co"># size of the grid</span></span>
<span>  seed <span class="op">=</span> <span class="fl">372</span> <span class="co"># for exact reproducibility</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Check the dimensionality of the grid: number of rows is 10000 as
requested, number of columns is the same as the number of
covariates.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">pm</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 10000    11</span></span></code></pre></div>
<p>We will sculpt the model using the generated product marginals:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rough_sculpture</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sculpt_rough.html">sculpt_rough</a></span><span class="op">(</span></span>
<span>  dat <span class="op">=</span> <span class="va">pm</span>,</span>
<span>  model_predict_fun <span class="op">=</span> <span class="va">xgb_pred</span>,</span>
<span>  n_ice <span class="op">=</span> <span class="fl">10</span>, <span class="co"># number of ICE curves - increasing this number may increase the stability of the sculpture</span></span>
<span>  seed <span class="op">=</span> <span class="fl">5</span> <span class="co"># for exact reproducibility</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The returned object is a (nested) list of used features with a couple
of elements for each feature:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">rough_sculpture</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rough sculpture with 11 variables</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/typeof.html" class="external-link">typeof</a></span><span class="op">(</span><span class="va">rough_sculpture</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "list"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">rough_sculpture</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 11</span></span>
<span><span class="co">#&gt;  $ season    :List of 7</span></span>
<span><span class="co">#&gt;  $ yr        :List of 7</span></span>
<span><span class="co">#&gt;  $ mnth      :List of 7</span></span>
<span><span class="co">#&gt;  $ holiday   :List of 7</span></span>
<span><span class="co">#&gt;  $ weekday   :List of 7</span></span>
<span><span class="co">#&gt;  $ workingday:List of 7</span></span>
<span><span class="co">#&gt;  $ weathersit:List of 7</span></span>
<span><span class="co">#&gt;  $ temp      :List of 7</span></span>
<span><span class="co">#&gt;  $ atemp     :List of 7</span></span>
<span><span class="co">#&gt;  $ hum       :List of 7</span></span>
<span><span class="co">#&gt;  $ windspeed :List of 7</span></span>
<span><span class="co">#&gt;  - attr(*, "offset")= num 4510</span></span>
<span><span class="co">#&gt;  - attr(*, "class")= chr [1:3] "rough" "sculpture" "list"</span></span>
<span><span class="co">#&gt;  - attr(*, "var_imp")=Classes 'data.table' and 'data.frame': 11 obs. of  4 variables:</span></span>
<span><span class="co">#&gt;   ..- attr(*, ".internal.selfref")=&lt;externalptr&gt; </span></span>
<span><span class="co">#&gt;  - attr(*, "cumul_R2")=Classes 'data.table' and 'data.frame':    11 obs. of  2 variables:</span></span>
<span><span class="co">#&gt;   ..- attr(*, ".internal.selfref")=&lt;externalptr&gt; </span></span>
<span><span class="co">#&gt;  - attr(*, "range")=Classes 'data.table' and 'data.frame':   11 obs. of  2 variables:</span></span>
<span><span class="co">#&gt;   ..- attr(*, ".internal.selfref")=&lt;externalptr&gt; </span></span>
<span><span class="co">#&gt; NULL</span></span></code></pre></div>
<p>Let’s display the ICE and PDP curves to understand how the individual
features influence the model:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ip</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/g_ice.html">g_ice</a></span><span class="op">(</span><span class="va">rough_sculpture</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ip</span><span class="op">$</span><span class="va">continuous</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="modsculpt_files/figure-html/unnamed-chunk-22-1.png" width="960"></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ip</span><span class="op">$</span><span class="va">discrete</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="modsculpt_files/figure-html/unnamed-chunk-23-1.png" width="960"></p>
<p>We would also like to see the direct variable importance, a quantity
that we have defined in model sculpting. It can be interpreted as
feature importance based on the provided model</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vip</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/g_var_imp.html">g_var_imp</a></span><span class="op">(</span><span class="va">rough_sculpture</span>, textsize <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span><span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/grid.draw.html" class="external-link">grid.draw</a></span><span class="op">(</span><span class="va">vip</span><span class="op">)</span></span></code></pre></div>
<p><img src="modsculpt_files/figure-html/unnamed-chunk-24-1.png" width="960"></p>
<p>You can compare this with the variable importances generated by the
xgboost.</p>
</div>
<div class="section level3">
<h3 id="build-a-detailed-model">Build a detailed model<a class="anchor" aria-label="anchor" href="#build-a-detailed-model"></a>
</h3>
<p>The next step in model sculpting is to smooth the individual PDP
curves. This ensures more clear interpretation of the sculpted results.
This model we call a detailed model.</p>
<p>You can freely choose which smoothers you would like to use, but you
need to write your own function for that. So far, we have prepared two
versions: linear models (using <code>lm</code>) and generalized additive
models (using <code><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">mgcv::gam</a></code> with smoothness).</p>
<div class="section level4">
<h4 id="detailed-model-using-lm-smoother">Detailed model using lm smoother<a class="anchor" aria-label="anchor" href="#detailed-model-using-lm-smoother"></a>
</h4>
<p>Let’s start with a linear smoother We create a detailed model using
<code>lm</code> smoother based on the rough model above:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">detailed_sculpture_lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sculpt_detailed_lm.html">sculpt_detailed_lm</a></span><span class="op">(</span><span class="va">rough_sculpture</span><span class="op">)</span></span></code></pre></div>
<p>Let’s have a look at the results.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dsp_lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/g_component.html">g_component</a></span><span class="op">(</span><span class="va">detailed_sculpture_lm</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dsp_lm</span><span class="op">$</span><span class="va">continuous</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="modsculpt_files/figure-html/unnamed-chunk-27-1.png" width="960"></p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dsp_lm</span><span class="op">$</span><span class="va">discrete</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="modsculpt_files/figure-html/unnamed-chunk-28-1.png" width="960"></p>
<p>We also show the direct variable importance for this detailed
sculpture with lm smoother. Remember to use the product marginals when
analysing direct variable importance.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vip_lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/g_var_imp.html">g_var_imp</a></span><span class="op">(</span><span class="va">detailed_sculpture_lm</span>, textsize <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span><span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/grid.draw.html" class="external-link">grid.draw</a></span><span class="op">(</span><span class="va">vip_lm</span><span class="op">)</span></span></code></pre></div>
<p><img src="modsculpt_files/figure-html/unnamed-chunk-29-1.png" width="960"></p>
</div>
<div class="section level4">
<h4 id="detailed-model-using-gam-smoother">Detailed model using gam smoother<a class="anchor" aria-label="anchor" href="#detailed-model-using-gam-smoother"></a>
</h4>
<p>We are going to do the same as above just with a different smoother -
using <code><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">mgcv::gam</a></code> with smoothness <code><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">mgcv::s</a></code>.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">detailed_sculpture_gam</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sculpt_detailed_gam.html">sculpt_detailed_gam</a></span><span class="op">(</span><span class="va">rough_sculpture</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required namespace: mgcv</span></span></code></pre></div>
<p>Let’s have a look at the results.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dsp_gam</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/g_component.html">g_component</a></span><span class="op">(</span><span class="va">detailed_sculpture_gam</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dsp_gam</span><span class="op">$</span><span class="va">continuous</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="modsculpt_files/figure-html/unnamed-chunk-32-1.png" width="960"></p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dsp_gam</span><span class="op">$</span><span class="va">discrete</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="modsculpt_files/figure-html/unnamed-chunk-33-1.png" width="960"></p>
<p>We again show the direct variable importance for this detailed
sculpture with gam smoother.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vip_gam</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/g_var_imp.html">g_var_imp</a></span><span class="op">(</span><span class="va">detailed_sculpture_gam</span>, textsize <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span><span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/grid.draw.html" class="external-link">grid.draw</a></span><span class="op">(</span><span class="va">vip_gam</span><span class="op">)</span></span></code></pre></div>
<p><img src="modsculpt_files/figure-html/unnamed-chunk-34-1.png" width="960"></p>
</div>
<div class="section level4">
<h4 id="detailed-model-using-arbitrary-smoother">Detailed model using arbitrary smoother<a class="anchor" aria-label="anchor" href="#detailed-model-using-arbitrary-smoother"></a>
</h4>
<p>You can also define your own arbitrary smoother and build a detailed
model on your own.</p>
<p>For that you can use function <code>sculpt_detailed_generic</code>,
which works similarly as <code>sculpt_detailed_lm</code> or
<code>sculpt_detailed_gam</code>, you just need to provide the
definitions of your smoother (parameter <code>smoother_fun</code>) and
smoother prediction function (parameter
<code>smoother_predict_fun</code>). See the documentation for more
info.</p>
</div>
</div>
<div class="section level3">
<h3 id="build-a-polished-model">Build a polished model<a class="anchor" aria-label="anchor" href="#build-a-polished-model"></a>
</h3>
<p>Once we have all the variable importances, we can reduce the model to
only a few terms while keeping the highest performance possible. For
example, if we decide to go with the detailed model using gam smoothers,
and if we aim for at least 95% performance of the original model, we see
in the graph above that we can take only <code>yr</code>,
<code>temp</code>, <code>season</code>, <code>hum</code>,
<code>atemp</code>, <code>windspeed</code> and <code>weathersit</code>
features.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">polished_sculpture</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sculpt_polished.html">sculpt_polished</a></span><span class="op">(</span></span>
<span>  <span class="va">detailed_sculpture_gam</span>,</span>
<span>  vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"yr"</span>, <span class="st">"temp"</span>, <span class="st">"season"</span>, <span class="st">"hum"</span>, <span class="st">"atemp"</span>, <span class="st">"windspeed"</span>, <span class="st">"weathersit"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">polished_sculpture</span><span class="op">)</span> <span class="co"># only 7 out of 11 variables included</span></span>
<span><span class="co">#&gt; [1] 7</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="compare-results">Compare results<a class="anchor" aria-label="anchor" href="#compare-results"></a>
</h3>
<p>Let’s compare the predictions of the original model vs sculpted
models (<span class="math inline">\(R^2 = 1\)</span> would mean exact
match to the xgboost predictions).</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/g_additivity.html">g_additivity</a></span><span class="op">(</span></span>
<span>  sp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">rough_sculpture</span>, <span class="va">pm</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">detailed_sculpture_lm</span>, <span class="va">pm</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">detailed_sculpture_gam</span>, <span class="va">pm</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">polished_sculpture</span>, <span class="va">pm</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  lp <span class="op">=</span> <span class="fu">xgb_pred</span><span class="op">(</span><span class="va">pm</span><span class="op">)</span>,</span>
<span>  descriptions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"Rough Model"</span>,</span>
<span>    <span class="st">"Detailed model - lm"</span>,</span>
<span>    <span class="st">"Detailed model - gam"</span>,</span>
<span>    <span class="st">"Polished model"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  cex <span class="op">=</span> <span class="fl">4</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="modsculpt_files/figure-html/unnamed-chunk-37-1.png" width="768"></p>
<p>Here we can see the influence of each feature in each of the sculpted
model.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">scp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/g_comparison.html">g_comparison</a></span><span class="op">(</span></span>
<span>  sculptures <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">rough_sculpture</span>, <span class="va">detailed_sculpture_lm</span>, <span class="va">detailed_sculpture_gam</span><span class="op">)</span>,</span>
<span>  descriptions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Rough"</span>, <span class="st">"lm"</span>, <span class="st">"gam"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">scp</span><span class="op">$</span><span class="va">continuous</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="modsculpt_files/figure-html/unnamed-chunk-39-1.png" width="960"></p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">scp</span><span class="op">$</span><span class="va">discrete</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="modsculpt_files/figure-html/unnamed-chunk-40-1.png" width="960"></p>
<div class="section level4">
<h4 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h4>
<p>Here we compare the performance of the strong learner with the
sculpted models on both train and holdout sets. We will use
<code><a href="../reference/metrics.html">score_quadratic()</a></code> and <code><a href="../reference/metrics.html">metrics_R2()</a></code> from the
package, which is the traditional coefficient of determination</p>
<p><strong>Train dataset</strong></p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">R2q</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span>, <span class="va">y_hat</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/metrics.html">metrics_R2</a></span><span class="op">(</span>score_fun <span class="op">=</span> <span class="st">"score_quadratic"</span>, y <span class="op">=</span> <span class="va">y</span>, y_hat <span class="op">=</span> <span class="va">y_hat</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">metrics_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"Strong learner"</span>,</span>
<span>    <span class="st">"Rough model"</span>,</span>
<span>    <span class="st">"Detailed model - lm"</span>,</span>
<span>    <span class="st">"Detailed model - gam"</span>,</span>
<span>    <span class="st">"Polished model"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  R2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="fu">R2q</span><span class="op">(</span><span class="va">df_t</span><span class="op">[[</span><span class="va">response</span><span class="op">]</span><span class="op">]</span>, <span class="fu">xgb_pred</span><span class="op">(</span><span class="va">df_t</span><span class="op">[</span><span class="va">covariates</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu">R2q</span><span class="op">(</span><span class="va">df_t</span><span class="op">[[</span><span class="va">response</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">rough_sculpture</span>, newdata <span class="op">=</span> <span class="va">df_t</span><span class="op">[</span><span class="va">covariates</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu">R2q</span><span class="op">(</span><span class="va">df_t</span><span class="op">[[</span><span class="va">response</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">detailed_sculpture_lm</span>, newdata <span class="op">=</span> <span class="va">df_t</span><span class="op">[</span><span class="va">covariates</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu">R2q</span><span class="op">(</span><span class="va">df_t</span><span class="op">[[</span><span class="va">response</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">detailed_sculpture_gam</span>, newdata <span class="op">=</span> <span class="va">df_t</span><span class="op">[</span><span class="va">covariates</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu">R2q</span><span class="op">(</span><span class="va">df_t</span><span class="op">[[</span><span class="va">response</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">polished_sculpture</span>, newdata <span class="op">=</span> <span class="va">df_t</span><span class="op">[</span><span class="va">covariates</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">metrics_train</span>, align <span class="op">=</span> <span class="st">"lcc"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">Model</th>
<th align="center">R2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Strong learner</td>
<td align="center">0.9273318</td>
</tr>
<tr class="even">
<td align="left">Rough model</td>
<td align="center">0.8726919</td>
</tr>
<tr class="odd">
<td align="left">Detailed model - lm</td>
<td align="center">0.7976886</td>
</tr>
<tr class="even">
<td align="left">Detailed model - gam</td>
<td align="center">0.8644481</td>
</tr>
<tr class="odd">
<td align="left">Polished model</td>
<td align="center">0.8603234</td>
</tr>
</tbody>
</table>
<p><strong>Holdout dataset</strong></p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">metrics_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"Strong learner"</span>,</span>
<span>    <span class="st">"Rough model"</span>,</span>
<span>    <span class="st">"Detailed model - lm"</span>,</span>
<span>    <span class="st">"Detailed model - gam"</span>,</span>
<span>    <span class="st">"Polished model"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  R2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="fu">R2q</span><span class="op">(</span><span class="va">df_h</span><span class="op">[[</span><span class="va">response</span><span class="op">]</span><span class="op">]</span>, <span class="fu">xgb_pred</span><span class="op">(</span><span class="va">df_h</span><span class="op">[</span><span class="va">covariates</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu">R2q</span><span class="op">(</span><span class="va">df_h</span><span class="op">[[</span><span class="va">response</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">rough_sculpture</span>, newdata <span class="op">=</span> <span class="va">df_h</span><span class="op">[</span><span class="va">covariates</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu">R2q</span><span class="op">(</span><span class="va">df_h</span><span class="op">[[</span><span class="va">response</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">detailed_sculpture_lm</span>, newdata <span class="op">=</span> <span class="va">df_h</span><span class="op">[</span><span class="va">covariates</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu">R2q</span><span class="op">(</span><span class="va">df_h</span><span class="op">[[</span><span class="va">response</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">detailed_sculpture_gam</span>, newdata <span class="op">=</span> <span class="va">df_h</span><span class="op">[</span><span class="va">covariates</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu">R2q</span><span class="op">(</span><span class="va">df_h</span><span class="op">[[</span><span class="va">response</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">polished_sculpture</span>, newdata <span class="op">=</span> <span class="va">df_h</span><span class="op">[</span><span class="va">covariates</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">metrics_test</span>, align <span class="op">=</span> <span class="st">"lcc"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">Model</th>
<th align="center">R2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Strong learner</td>
<td align="center">0.8718544</td>
</tr>
<tr class="even">
<td align="left">Rough model</td>
<td align="center">0.8523495</td>
</tr>
<tr class="odd">
<td align="left">Detailed model - lm</td>
<td align="center">0.7673903</td>
</tr>
<tr class="even">
<td align="left">Detailed model - gam</td>
<td align="center">0.8570278</td>
</tr>
<tr class="odd">
<td align="left">Polished model</td>
<td align="center">0.8505340</td>
</tr>
</tbody>
</table>
<p>Note that the only model with any interaction is the XGBoost (Strong
learner), all the other models are purely additive (i.e. without
interactions), which are much easier to interpret.</p>
<p>Based on the results above, it seems that removing the interaction
lowers the performance only slightly. Depending on the use case, it may
be better to use the less complex and more interpretable polished model
than the original strong learner.</p>
</div>
</div>
<div class="section level3">
<h3 id="density-plot">Density plot<a class="anchor" aria-label="anchor" href="#density-plot"></a>
</h3>
<p>The package also has functionality to visualize where the data were
located when the model was trained.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">density_plots</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/g_density_ice.html">g_density_ice_plot_list</a></span><span class="op">(</span><span class="va">rough_sculpture</span>, <span class="va">df_t</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"yr"</span>, <span class="st">"temp"</span>, <span class="st">"season"</span>, <span class="st">"hum"</span>, <span class="st">"atemp"</span>, <span class="st">"windspeed"</span>, <span class="st">"weathersit"</span><span class="op">)</span>,</span>
<span>    task <span class="op">=</span> <span class="st">"regression"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/grid.draw.html" class="external-link">grid.draw</a></span><span class="op">(</span></span>
<span>  <span class="fu">gridExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">arrangeGrob</a></span><span class="op">(</span></span>
<span>    grobs <span class="op">=</span> <span class="va">density_plots</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"yr"</span>, <span class="st">"temp"</span>, <span class="st">"season"</span>, <span class="st">"hum"</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="modsculpt_files/figure-html/unnamed-chunk-43-1.png" width="768"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Ondrej Slama, Kenta Yoshida, Christina Rabe, Michel Friesenhahn, F. Hoffmann-La Roche AG.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.8.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
