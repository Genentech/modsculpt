<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="modsculpt">
<title>Binary Response • modsculpt</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Binary Response">
<meta property="og:description" content="modsculpt">
<meta property="og:image" content="https://genentech.github.io/modsculpt/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary" data-bs-theme="dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">modsculpt</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/modsculpt.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../articles/binary.html">Binary Example</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-reports">Reports</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-reports">
    <a class="dropdown-item" href="../../unit-test-report/">Unit test report</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://www.github.com/genentech/modsculpt">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Binary Response</h1>
            
      
      
      <div class="d-none name"><code>binary.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Here we will show how to apply model sculpting for a binary
endpoint.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://genentech.github.io/modsculpt">modsculpt</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="data-preparation">Data preparation<a class="anchor" aria-label="anchor" href="#data-preparation"></a>
</h2>
<p>Download <code>compas_test.csv</code> and
<code>compas_train.csv</code> at <a href="https://github.com/corels/corels/tree/master/data" class="external-link">https://github.com/corels/corels/tree/master/data</a>
and read it in R.</p>
<p>You can use the following code to do this:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/corels/corels/master/data/compas_train.csv"</span><span class="op">)</span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/corels/corels/master/data/compas_test.csv"</span><span class="op">)</span></span></code></pre></div>
<p>In this dataset, <code>recidivate.within.two.years</code> is the
binary response that we want to predict, the other columns are
features.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">response</span> <span class="op">&lt;-</span> <span class="st">"recidivate.within.two.years"</span></span>
<span><span class="va">covariates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sex"</span>, <span class="st">"age"</span>, <span class="st">"juvenile.felonies"</span>, <span class="st">"juvenile.misdemeanors"</span>, <span class="st">"juvenile.crimes"</span>, <span class="st">"priors"</span>, <span class="st">"current.charge.degree"</span><span class="op">)</span></span></code></pre></div>
<p>All of the features are factors so let’s convert them:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">train</span><span class="op">[</span><span class="va">covariates</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">train</span><span class="op">[</span><span class="va">covariates</span><span class="op">]</span>, <span class="va">as.factor</span><span class="op">)</span></span>
<span><span class="co"># reorder levels</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">train</span><span class="op">$</span><span class="va">priors</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"=0"</span>, <span class="st">"=1"</span>, <span class="st">"2-3"</span>, <span class="st">"&gt;3"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">train</span><span class="op">$</span><span class="va">age</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"18-20"</span>, <span class="st">"21-22"</span>, <span class="st">"23-25"</span>, <span class="st">"26-45"</span>, <span class="st">"&gt;45"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">test</span><span class="op">[</span><span class="va">covariates</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">test</span><span class="op">[</span><span class="va">covariates</span><span class="op">]</span>, <span class="va">as.factor</span><span class="op">)</span></span>
<span><span class="co"># reorder levels</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">test</span><span class="op">$</span><span class="va">priors</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"=0"</span>, <span class="st">"=1"</span>, <span class="st">"2-3"</span>, <span class="st">"&gt;3"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">test</span><span class="op">$</span><span class="va">age</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"18-20"</span>, <span class="st">"21-22"</span>, <span class="st">"23-25"</span>, <span class="st">"26-45"</span>, <span class="st">"&gt;45"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="model-sculpting">Model Sculpting<a class="anchor" aria-label="anchor" href="#model-sculpting"></a>
</h2>
<div class="section level3">
<h3 id="build-a-base-model">Build a base model<a class="anchor" aria-label="anchor" href="#build-a-base-model"></a>
</h3>
<p>Firstly, check the NAs:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">anyNA</a></span><span class="op">(</span><span class="va">train</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<p>Secondly, check zero variance columns (all columns are factors):</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">train</span>, \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<p>Now let’s build a strong learner via xgboost (again with already
predefined parameters):</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"xgboost"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required namespace: xgboost</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">567</span><span class="op">)</span></span>
<span><span class="va">est</span> <span class="op">&lt;-</span> <span class="fu">xgboost</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/xgboost/man/xgb.train.html" class="external-link">xgb.train</a></span><span class="op">(</span></span>
<span>  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    booster <span class="op">=</span> <span class="st">"gbtree"</span>,</span>
<span>    objective <span class="op">=</span> <span class="st">"binary:logistic"</span>,</span>
<span>    eta <span class="op">=</span> <span class="fl">0.03</span>,</span>
<span>    gamma <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>    max_depth <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    min_child_weight <span class="op">=</span> <span class="fl">15</span>,</span>
<span>    colsample_bytree <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    subsample <span class="op">=</span> <span class="fl">0.5</span></span>
<span>  <span class="op">)</span>,</span>
<span>  nrounds <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  data <span class="op">=</span> <span class="fu">xgboost</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/xgboost/man/xgb.DMatrix.html" class="external-link">xgb.DMatrix</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="op">~</span> <span class="va">.</span> <span class="op">-</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">train</span><span class="op">[</span><span class="va">covariates</span><span class="op">]</span><span class="op">)</span>,</span>
<span>    label <span class="op">=</span> <span class="va">train</span><span class="op">[[</span><span class="va">response</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="op">)</span>,</span>
<span>  verbose <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  nthread <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Here you can see the variable importances based on xgboost:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">xgboost</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/xgboost/man/xgb.plot.importance.html" class="external-link">xgb.plot.importance</a></span><span class="op">(</span><span class="fu">xgboost</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/xgboost/man/xgb.importance.html" class="external-link">xgb.importance</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">est</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="binary_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="build-a-rough-model">Build a rough model<a class="anchor" aria-label="anchor" href="#build-a-rough-model"></a>
</h3>
<p>Let’s sculpt this xgboost model.</p>
<p>Firstly, we need to define a prediction function that takes data as
input and returns predictions based on the trained model (in this case,
the xgboost above).</p>
<p>For a binary response, it is worth to sculpt the model on the
log-odds scale instead of the probability scale since the xgboost is
built in the log-odds scale as well (see parameter
<code>objective = "binary:logistic"</code>).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xgb_pred</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">probs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">est</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="op">~</span> <span class="va">.</span> <span class="op">-</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">probs</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">probs</span><span class="op">)</span><span class="op">)</span> <span class="co"># convert to log of odds</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Secondly, we need to generate product marginals, a grid of values
that is sampled independently per each column from the original
dataset.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sample_marginals.html">sample_marginals</a></span><span class="op">(</span></span>
<span>  dat <span class="op">=</span> <span class="va">train</span><span class="op">[</span><span class="va">covariates</span><span class="op">]</span>, <span class="co"># generate product marginals based on original training data</span></span>
<span>  n <span class="op">=</span> <span class="fl">10000</span>, <span class="co"># size of the grid</span></span>
<span>  seed <span class="op">=</span> <span class="fl">372</span> <span class="co"># for exact reproducibility</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We will sculpt the model using the generated product marginals:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rough_sculpture</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sculpt_rough.html">sculpt_rough</a></span><span class="op">(</span></span>
<span>  dat <span class="op">=</span> <span class="va">pm</span>,</span>
<span>  model_predict_fun <span class="op">=</span> <span class="va">xgb_pred</span>,</span>
<span>  n_ice <span class="op">=</span> <span class="fl">10</span>, <span class="co"># number of ICE curves - increasing this number may increase the stability of the sculpture</span></span>
<span>  seed <span class="op">=</span> <span class="fl">5</span> <span class="co"># for exact reproducibility</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Let’s display the ICE and PDP curves to understand how the individual
features influence the model. Remember that y-axis (“Feature Score”)
describes the log of odds.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ip</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/g_ice.html">g_ice</a></span><span class="op">(</span><span class="va">rough_sculpture</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ip</span><span class="op">$</span><span class="va">discrete</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="binary_files/figure-html/unnamed-chunk-14-1.png" width="960"></p>
<p>Below we can see the direct variable importance:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vip</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/g_var_imp.html">g_var_imp</a></span><span class="op">(</span><span class="va">rough_sculpture</span>, textsize <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span><span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/grid.draw.html" class="external-link">grid.draw</a></span><span class="op">(</span><span class="va">vip</span><span class="op">)</span></span></code></pre></div>
<p><img src="binary_files/figure-html/unnamed-chunk-15-1.png" width="960"></p>
<p>You can compare this with the variable importances generated by the
xgboost.</p>
</div>
<div class="section level3">
<h3 id="build-a-polished-model">Build a polished model<a class="anchor" aria-label="anchor" href="#build-a-polished-model"></a>
</h3>
<p>Let’s jump to polished model now, using only the top 4 features:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">polished_sculpture</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sculpt_polished.html">sculpt_polished</a></span><span class="op">(</span></span>
<span>  <span class="va">rough_sculpture</span>,</span>
<span>  vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"priors"</span>, <span class="st">"juvenile.crimes"</span>, <span class="st">"age"</span>, <span class="st">"sex"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="compare-results">Compare results<a class="anchor" aria-label="anchor" href="#compare-results"></a>
</h3>
<p>Let’s compare the predictions of the original model vs sculpted
models (<span class="math inline">\(R^2 = 1\)</span> would mean exact
match to the xgboost predictions).</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/g_additivity.html">g_additivity</a></span><span class="op">(</span></span>
<span>  sp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">rough_sculpture</span>, <span class="va">pm</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">polished_sculpture</span>, <span class="va">pm</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  lp <span class="op">=</span> <span class="fu">xgb_pred</span><span class="op">(</span><span class="va">pm</span><span class="op">)</span>,</span>
<span>  descriptions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Rough Model"</span>, <span class="st">"Polished model"</span><span class="op">)</span>,</span>
<span>  cex <span class="op">=</span> <span class="fl">4</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="binary_files/figure-html/unnamed-chunk-17-1.png" width="768"></p>
<p><strong>Test dataset</strong></p>
<p>Finally, below we compare the performance of the model (using
quadratic loss):</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">R2q</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span>, <span class="va">y_hat</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/metrics.html">metrics_R2</a></span><span class="op">(</span>score_fun <span class="op">=</span> <span class="st">"score_quadratic"</span>, y <span class="op">=</span> <span class="va">y</span>, y_hat <span class="op">=</span> <span class="va">y_hat</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Remember that the predictions refer to the log of odds. To convert
this to probabilities, we need to transform them:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inv.logit</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">metrics_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"Strong learner"</span>,</span>
<span>    <span class="st">"Rough model"</span>,</span>
<span>    <span class="st">"Polished model"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  R2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="fu">R2q</span><span class="op">(</span><span class="va">test</span><span class="op">[[</span><span class="va">response</span><span class="op">]</span><span class="op">]</span>, <span class="fu">inv.logit</span><span class="op">(</span><span class="fu">xgb_pred</span><span class="op">(</span><span class="va">test</span><span class="op">[</span><span class="va">covariates</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu">R2q</span><span class="op">(</span><span class="va">test</span><span class="op">[[</span><span class="va">response</span><span class="op">]</span><span class="op">]</span>, <span class="fu">inv.logit</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">rough_sculpture</span>, newdata <span class="op">=</span> <span class="va">test</span><span class="op">[</span><span class="va">covariates</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu">R2q</span><span class="op">(</span><span class="va">test</span><span class="op">[[</span><span class="va">response</span><span class="op">]</span><span class="op">]</span>, <span class="fu">inv.logit</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">polished_sculpture</span>, newdata <span class="op">=</span> <span class="va">test</span><span class="op">[</span><span class="va">covariates</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">metrics_test</span>, align <span class="op">=</span> <span class="st">"lc"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">Model</th>
<th align="center">R2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Strong learner</td>
<td align="center">0.1604679</td>
</tr>
<tr class="even">
<td align="left">Rough model</td>
<td align="center">0.1598891</td>
</tr>
<tr class="odd">
<td align="left">Polished model</td>
<td align="center">0.1571700</td>
</tr>
</tbody>
</table>
<p>Since the “Strong learner” is the only model with interactions, the
table above suggests that the interactions are not significant as the
performance of the “Rough model” is almost the same.</p>
<p>What is more, using the “Polished model” with only 4 selected
features further reduces the model complexity without any significant
performance loss.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Ondrej Slama, Kenta Yoshida, Christina Rabe, Michel Friesenhahn, F. Hoffmann-La Roche AG.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.8.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
